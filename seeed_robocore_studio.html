<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seeed RoboCore Studio - æœºå™¨äººæ§åˆ¶å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --seeed-green: #00D5A4;
            --seeed-dark: #1A1A2E;
            --seeed-light: #F5F5F5;
            --primary-color: #00D5A4;
            --secondary-color: #FF6B6B;
            --accent-color: #4ECDC4;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å“ç‰Œå¤´éƒ¨ */
        .brand-header {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .brand-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            background: var(--seeed-green);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }

        .brand-title h1 {
            background: linear-gradient(135deg, #00D5A4 0%, #4ECDC4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .brand-subtitle {
            color: #718096;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1rem;
            justify-content: center;
            padding: 12px 20px;
            background: #F8F9FA;
            border-radius: 8px;
            border: 1px solid #E9ECEF;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--secondary-color);
            animation: pulse 2s infinite;
            transition: var(--transition);
        }

        .status-indicator.connected {
            background: var(--seeed-green);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        /* ä¸»å¸ƒå±€ */
        .main-grid {
            display: grid;
            grid-template-columns: 320px 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* å¡ç‰‡åŸºç¡€æ ·å¼ */
        .panel {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E9ECEF;
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 600;
            color: #2D3748;
        }

        .panel-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--seeed-green), var(--accent-color));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        /* æ ‡ç­¾å¯¼èˆª */
        .tab-container {
            display: flex;
            background: #F8F9FA;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 20px;
            border: 1px solid #E9ECEF;
        }

        .tab {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: #718096;
            background: transparent;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .tab:hover {
            background: rgba(0, 213, 164, 0.1);
        }

        .tab.active {
            background: var(--seeed-green);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 213, 164, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æŒ‰é’®æ ·å¼ */
        .button {
            background: var(--seeed-green);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 213, 164, 0.3);
        }

        .button:hover {
            background: #00B894;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 213, 164, 0.4);
        }

        .button.danger {
            background: var(--secondary-color);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .button.danger:hover {
            background: #FF5252;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .button.secondary {
            background: #6C757D;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .button.secondary:hover {
            background: #5A6268;
        }

        .button.success {
            background: #28A745;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        /* è®¾å¤‡åˆ—è¡¨ */
        .servo-item {
            background: #F8F9FA;
            border: 2px solid #E9ECEF;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .servo-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--seeed-green);
            transform: translateX(-100%);
            transition: var(--transition);
        }

        .servo-item:hover {
            background: #E8F5E8;
            border-color: var(--seeed-green);
            transform: translateX(4px);
        }

        .servo-item.selected {
            background: #E8F5E8;
            border-color: var(--seeed-green);
        }

        .servo-item.selected::before {
            transform: translateX(0);
        }

        .servo-id {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2D3748;
            margin-bottom: 5px;
        }

        .servo-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #718096;
        }

        .servo-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28A745;
        }

        .servo-details {
            font-size: 0.75rem;
            color: #A0AEC0;
            margin-top: 3px;
            display: flex;
            gap: 10px;
        }

        .servo-detail-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .scan-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #F0F9FF;
            border: 1px solid #BAE6FD;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #0369A1;
            margin-bottom: 10px;
        }

        .calibration-step-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .calibration-step-card {
            background: white;
            border: 2px solid #E9ECEF;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .calibration-step-card:hover {
            border-color: var(--seeed-green);
            background: #F0FDF4;
        }

        .calibration-step-card.active {
            border-color: var(--seeed-green);
            background: #E8F5E8;
        }

        .calibration-step-card.completed {
            border-color: #28A745;
            background: #F0FFF4;
        }

        .step-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .step-title {
            font-weight: 600;
            color: #2D3748;
            margin-bottom: 4px;
        }

        .step-description {
            font-size: 0.75rem;
            color: #718096;
        }

        .manual-calibration-mode {
            background: #FFF7ED;
            border: 2px solid #FED7AA;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .manual-mode-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #EA580C;
            font-weight: 600;
        }

        .disable-torque-button {
            background: #F59E0B;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .disable-torque-button:hover {
            background: #D97706;
        }

        .disable-torque-button.active {
            background: #DC2626;
        }

        .position-indicator {
            display: inline-block;
            padding: 4px 8px;
            background: #FEF3C7;
            border: 1px solid #FCD34D;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #92400E;
            margin-left: 10px;
        }

        /* æ§åˆ¶ç»„ä»¶ */
        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2D3748;
            font-size: 0.9rem;
        }

        .control-group input, .control-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E9ECEF;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
            background: white;
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: var(--seeed-green);
            box-shadow: 0 0 0 3px rgba(0, 213, 164, 0.1);
        }

        /* æ»‘å—æ ·å¼ */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #E9ECEF;
            outline: none;
            transition: var(--transition);
        }

        .slider:hover {
            background: #DEE2E6;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--seeed-green);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 213, 164, 0.3);
        }

        .slider::-webkit-slider-thumb:hover {
            background: #00B894;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 213, 164, 0.4);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--seeed-green);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 213, 164, 0.3);
            border: none;
        }

        .slider-value {
            min-width: 70px;
            text-align: center;
            font-weight: 700;
            color: var(--seeed-green);
            background: #E8F5E8;
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid var(--seeed-green);
            font-size: 0.9rem;
        }

        .input-slider-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-slider-group input[type="number"] {
            flex: 0 0 100px;
        }

        /* å®æ—¶æ§åˆ¶æŒ‡ç¤ºå™¨ */
        .realtime-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #E8F5E8;
            color: var(--seeed-green);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .realtime-dot {
            width: 8px;
            height: 8px;
            background: var(--seeed-green);
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        /* æ§åˆ¶æ¨¡å¼åˆ‡æ¢ */
        .control-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: #F8F9FA;
            padding: 4px;
            border-radius: 10px;
        }

        .mode-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.9rem;
            background: transparent;
            color: #718096;
        }

        .mode-button.active {
            background: var(--seeed-green);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 213, 164, 0.3);
        }

        /* å¿«é€Ÿé¢„è®¾æŒ‰é’® */
        .preset-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .preset-button {
            padding: 10px;
            border: 2px solid #E9ECEF;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.85rem;
            color: #2D3748;
        }

        .preset-button:hover {
            border-color: var(--seeed-green);
            background: #E8F5E8;
            transform: translateY(-1px);
        }

        /* æŠ˜å é¢æ¿ */
        .collapsible {
            background: #F8F9FA;
            border: 1px solid #E9ECEF;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .collapsible-header {
            padding: 15px 20px;
            background: #FFFFFF;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border-bottom: 1px solid #E9ECEF;
        }

        .collapsible-header:hover {
            background: #F8F9FA;
        }

        .collapsible-title {
            font-weight: 600;
            color: #2D3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .collapsible-icon {
            transition: var(--transition);
            color: #718096;
        }

        .collapsible-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
        }

        .collapsible.open .collapsible-content {
            padding: 20px;
            max-height: 1000px;
        }

        .collapsible.open .collapsible-icon {
            transform: rotate(180deg);
        }

        /* çŠ¶æ€æ˜¾ç¤º */
        .status-display {
            background: #F8F9FA;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #E9ECEF;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .status-label {
            color: #718096;
            font-weight: 500;
        }

        .status-value {
            font-weight: 700;
            color: #2D3748;
            background: white;
            padding: 4px 12px;
            border-radius: 6px;
            border: 1px solid #E9ECEF;
        }

        /* æ—¥å¿— */
        .log {
            background: var(--seeed-dark);
            color: #E2E8F0;
            border-radius: 10px;
            padding: 20px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #2D3748;
        }

        .log-entry {
            margin-bottom: 4px;
            padding: 2px 0;
            border-left: 3px solid transparent;
            padding-left: 8px;
        }

        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .log-entry.info { color: #63B3ED; border-left-color: #63B3ED; }
        .log-entry.success { color: #68D391; border-left-color: #68D391; }
        .log-entry.warning { color: #F6E05E; border-left-color: #F6E05E; }
        .log-entry.error { color: #FC8181; border-left-color: #FC8181; }

        /* æ ‡å®šå‘å¯¼ */
        .wizard-step {
            display: none;
            animation: slideIn 0.3s ease-in-out;
        }

        .wizard-step.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
        }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #E9ECEF;
            z-index: 0;
        }

        .progress-step {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #E9ECEF;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .progress-step.completed .step-circle {
            background: var(--seeed-green);
            border-color: var(--seeed-green);
            color: white;
        }

        .progress-step.active .step-circle {
            border-color: var(--seeed-green);
            background: white;
            color: var(--seeed-green);
            box-shadow: 0 0 0 4px rgba(0, 213, 164, 0.2);
        }

        .step-label {
            font-size: 0.8rem;
            color: #718096;
            text-align: center;
            max-width: 80px;
        }

        .progress-step.active .step-label {
            color: var(--seeed-green);
            font-weight: 600;
        }

        .wizard-content {
            background: #F8F9FA;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #E9ECEF;
        }

        .wizard-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2D3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .wizard-description {
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .wizard-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .brand-title h1 {
                font-size: 1.8rem;
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .preset-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #E9ECEF;
            border-radius: 50%;
            border-top-color: var(--seeed-green);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æç¤ºæ¡† */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--seeed-dark);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .empty-description {
            font-size: 0.9rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å“ç‰Œå¤´éƒ¨ -->
        <div class="brand-header">
            <div class="brand-title">
                <div class="brand-logo">S</div>
                <h1>Seeed RoboCore Studio</h1>
            </div>
            <div class="brand-subtitle">
                Professional Robot Control Platform - by Seeed Studio
            </div>
            <div class="connection-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="connectionStatus">æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</span>
                <span id="monitoringStatus" style="display: none;" class="realtime-indicator">
                    <span class="realtime-dot"></span>
                    å®æ—¶ç›‘æ§ä¸­
                </span>
            </div>
        </div>

        <!-- ä¸»å¸ƒå±€ -->
        <div class="main-grid">
            <!-- å·¦ä¾§é¢æ¿ - è®¾å¤‡ç®¡ç†å’Œæ ‡å®š -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon">ğŸ”§</div>
                        <span>è®¾å¤‡ç®¡ç†</span>
                    </div>
                </div>

                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="button-group">
                    <button class="button" onclick="scanServos()">
                        <span>ğŸ”</span> é‡æ–°æ‰«æ
                    </button>
                    <button class="button success" onclick="startCalibrationWizard()">
                        <span>âš™ï¸</span> è®¾å¤‡æ ‡å®š
                    </button>
                </div>

                <!-- æ‰«æçŠ¶æ€ -->
                <div id="scanStatus" style="display: none;" class="scan-status">
                    <div class="loading"></div>
                    <span>æ­£åœ¨æ‰«æè®¾å¤‡...</span>
                </div>

                <!-- è®¾å¤‡åˆ—è¡¨ -->
                <div id="servoList">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ¤–</div>
                        <div class="empty-title">æœªå‘ç°è®¾å¤‡</div>
                        <div class="empty-description">ç‚¹å‡»"é‡æ–°æ‰«æ"æŒ‰é’®æ¥æœç´¢è¿æ¥çš„èˆµæœº</div>
                    </div>
                </div>
            </div>

            <!-- ä¸­é—´é¢æ¿ - å®æ—¶æ§åˆ¶ -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon">ğŸ›ï¸</div>
                        <span>å®æ—¶æ§åˆ¶</span>
                    </div>
                </div>

                <!-- æ§åˆ¶æ ‡ç­¾é¡µ -->
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('control')">å®æ—¶æ§åˆ¶</button>
                    <button class="tab" onclick="switchTab('calibration')">è®¾å¤‡æ ‡å®š</button>
                    <button class="tab" onclick="switchTab('advanced')">é«˜çº§åŠŸèƒ½</button>
                </div>

                <!-- å®æ—¶æ§åˆ¶æ ‡ç­¾é¡µ -->
                <div id="control-tab" class="tab-content active">
                    <div id="controlPanel">
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ®</div>
                            <div class="empty-title">è¯·é€‰æ‹©è®¾å¤‡</div>
                            <div class="empty-description">ä»å·¦ä¾§è®¾å¤‡åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªèˆµæœºå¼€å§‹æ§åˆ¶</div>
                        </div>
                    </div>
                </div>

                <!-- è®¾å¤‡æ ‡å®šæ ‡ç­¾é¡µ -->
                <div id="calibration-tab" class="tab-content">
                    <div id="calibrationPanel">
                        <!-- çµæ´»æ ‡å®šå†…å®¹ -->
                        <div class="wizard-content">
                            <div class="wizard-title">
                                <span>ğŸ¯</span>
                                <span>è®¾å¤‡æ ‡å®šä¸­å¿ƒ</span>
                            </div>
                            <div class="wizard-description">
                                é€‰æ‹©éœ€è¦æ ‡å®šçš„é¡¹ç›®ï¼Œå¯ä»¥å•ç‹¬è¿›è¡ŒIDé…ç½®ã€æ¸©åº¦é™åˆ¶è®¾ç½®æˆ–ä¸­ä½æ ¡å‡†
                            </div>

                            <!-- æ ‡å®šé¡¹ç›®é€‰æ‹©å™¨ -->
                            <div class="calibration-step-selector">
                                <div class="calibration-step-card" id="calibration-id" onclick="selectCalibrationType('id')">
                                    <div class="step-icon">ğŸ·ï¸</div>
                                    <div class="step-title">IDé…ç½®</div>
                                    <div class="step-description">è®¾ç½®èˆµæœºå”¯ä¸€æ ‡è¯†ID</div>
                                </div>
                                <div class="calibration-step-card" id="calibration-temp" onclick="selectCalibrationType('temperature')">
                                    <div class="step-icon">ğŸŒ¡ï¸</div>
                                    <div class="step-title">æ¸©åº¦é™åˆ¶</div>
                                    <div class="step-description">è®¾ç½®æ¸©åº¦ä¿æŠ¤é˜ˆå€¼</div>
                                </div>
                                <div class="calibration-step-card" id="calibration-center" onclick="selectCalibrationType('center')">
                                    <div class="step-icon">ğŸ¯</div>
                                    <div class="step-title">ä¸­ä½æ ¡å‡†</div>
                                    <div class="step-description">æ‰‹åŠ¨æ ¡å‡†èˆµæœºä¸­ä½</div>
                                </div>
                            </div>

                            <!-- æ ‡å®šå†…å®¹åŒºåŸŸ -->
                            <div id="calibrationContent" style="margin-top: 20px;">
                                <div class="empty-state">
                                    <div class="empty-icon">ğŸ¯</div>
                                    <div class="empty-title">é€‰æ‹©æ ‡å®šé¡¹ç›®</div>
                                    <div class="empty-description">ç‚¹å‡»ä¸Šæ–¹æ ‡å®šå¡ç‰‡å¼€å§‹å…·ä½“çš„æ ‡å®šæ“ä½œ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é«˜çº§åŠŸèƒ½æ ‡ç­¾é¡µ -->

                            <div id="step2-content" class="wizard-step">
                                <h4>æ­¥éª¤ 2: é…ç½®èˆµæœºID</h4>
                                <p>ä¸ºèˆµæœºè®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„IDæ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨è¿ç»­çš„æ•°å­—ç¼–å·ã€‚</p>
                                <div class="control-group">
                                    <label>èˆµæœºID (1-253)</label>
                                    <input type="number" id="calibrationServoId" min="1" max="253" value="1">
                                </div>
                                <button class="button" onclick="setCalibrationServoId()">
                                    <span>ğŸ’¾</span> è®¾ç½®ID
                                </button>
                            </div>

                            <div id="step3-content" class="wizard-step">
                                <h4>æ­¥éª¤ 3: æ¸©åº¦é™åˆ¶é…ç½®</h4>
                                <p>è®¾ç½®èˆµæœºçš„æ¸©åº¦ä¿æŠ¤é˜ˆå€¼ï¼Œé˜²æ­¢è¿‡çƒ­æŸåè®¾å¤‡ã€‚</p>
                                <div class="control-group">
                                    <label>æ¸©åº¦é™åˆ¶ (Â°C)</label>
                                    <div class="slider-container">
                                        <input type="range" id="tempLimitSlider" class="slider" min="50" max="100" value="75" oninput="updateTempLimitDisplay(this.value)">
                                        <span class="slider-value" id="tempLimitDisplay">75Â°C</span>
                                    </div>
                                </div>
                                <button class="button" onclick="setTemperatureLimit()">
                                    <span>ğŸŒ¡ï¸</span> è®¾ç½®æ¸©åº¦é™åˆ¶
                                </button>
                            </div>

                            <div id="step4-content" class="wizard-step">
                                <h4>æ­¥éª¤ 4: ä¸­ä½æ ¡å‡†</h4>
                                <p>å°†èˆµæœºè°ƒæ•´åˆ°ç‰©ç†ä¸­ä½ä½ç½®ï¼Œç¡®ä¿èˆµç›˜æœä¸Šæ—¶çš„ç²¾åº¦ã€‚</p>
                                <div class="control-group">
                                    <label>ä¸­ä½ä½ç½® (0-4095)</label>
                                    <div class="slider-container">
                                        <input type="range" id="centerPositionSlider" class="slider" min="0" max="4095" value="2048" oninput="updateCenterPositionDisplay(this.value)">
                                        <span class="slider-value" id="centerPositionDisplay">2048</span>
                                    </div>
                                </div>
                                <div class="button-group">
                                    <button class="button" onclick="moveToCenterPosition()">
                                        <span>ğŸ¯</span> ç§»åŠ¨åˆ°ä¸­ä½
                                    </button>
                                    <button class="button success" onclick="saveCenterPosition()">
                                        <span>ğŸ’¾</span> ä¿å­˜ä¸­ä½
                                    </button>
                                </div>
                                <p style="margin-top: 15px; font-size: 0.85rem; color: #718096;">
                                    ğŸ’¡ æç¤ºï¼šè°ƒæ•´æ»‘å—ç›´åˆ°èˆµç›˜å®Œå…¨æœä¸Šï¼Œç„¶åç‚¹å‡»"ä¿å­˜ä¸­ä½"ã€‚
                                </p>
                            </div>

                            <div id="step5-content" class="wizard-step">
                                <h4>æ­¥éª¤ 5: æ ‡å®šå®Œæˆ</h4>
                                <p>ğŸ‰ æ­å–œï¼æ‚¨çš„èˆµæœºæ ‡å®šå·²å®Œæˆã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨å®æ—¶æ§åˆ¶åŠŸèƒ½äº†ã€‚</p>
                                <div style="background: #E8F5E8; border: 2px solid var(--seeed-green); border-radius: 8px; padding: 15px; margin: 15px 0;">
                                    <div style="font-weight: 600; color: var(--seeed-green); margin-bottom: 10px;">âœ… æ ‡å®šæ‘˜è¦</div>
                                    <div style="font-size: 0.9rem; color: #2D3748;">
                                        <div>èˆµæœºID: <span id="summaryServoId">-</span></div>
                                        <div>æ¸©åº¦é™åˆ¶: <span id="summaryTempLimit">-</span></div>
                                        <div>ä¸­ä½ä½ç½®: <span id="summaryCenterPosition">-</span></div>
                                    </div>
                                </div>
                                <div class="button-group">
                                    <button class="button" onclick="restartCalibration()">
                                        <span>ğŸ”„</span> é‡æ–°æ ‡å®š
                                    </button>
                                    <button class="button success" onclick="finishCalibration()">
                                        <span>ğŸš€</span> å¼€å§‹ä½¿ç”¨
                                    </button>
                                </div>
                            </div>

                            <!-- å‘å¯¼å¯¼èˆªæŒ‰é’® -->
                            <div class="wizard-actions">
                                <button class="button secondary" onclick="previousCalibrationStep()" id="prevButton" style="width: auto; visibility: hidden;">
                                    <span>â†</span> ä¸Šä¸€æ­¥
                                </button>
                                <button class="button" onclick="nextCalibrationStep()" id="nextButton" style="width: auto;">
                                    ä¸‹ä¸€æ­¥ <span>â†’</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é«˜çº§åŠŸèƒ½æ ‡ç­¾é¡µ -->
                <div id="advanced-tab" class="tab-content">
                    <div id="advancedPanel">
                        <!-- æŠ˜å é¢æ¿çš„é«˜çº§åŠŸèƒ½ -->
                        <div class="collapsible" id="pidPanel">
                            <div class="collapsible-header" onclick="toggleCollapsible('pidPanel')">
                                <div class="collapsible-title">
                                    <span>âš™ï¸</span>
                                    <span>PIDå‚æ•°è°ƒèŠ‚</span>
                                </div>
                                <span class="collapsible-icon">â–¼</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="control-group">
                                    <label>ä½ç½®PIDå‚æ•°</label>
                                    <div class="input-slider-group">
                                        <span>P:</span>
                                        <input type="number" id="posP" min="0" max="255" value="32">
                                        <span>I:</span>
                                        <input type="number" id="posI" min="0" max="255" value="0">
                                        <span>D:</span>
                                        <input type="number" id="posD" min="0" max="255" value="32">
                                    </div>
                                </div>
                                <div class="button-group">
                                    <button class="button" onclick="readPidParams()">è¯»å–å‚æ•°</button>
                                    <button class="button success" onclick="writePidParams()">ä¿å­˜å‚æ•°</button>
                                </div>
                            </div>
                        </div>

                        <div class="collapsible" id="memoryPanel">
                            <div class="collapsible-header" onclick="toggleCollapsible('memoryPanel')">
                                <div class="collapsible-title">
                                    <span>ğŸ’¾</span>
                                    <span>å†…å­˜è®¿é—®</span>
                                </div>
                                <span class="collapsible-icon">â–¼</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="control-group">
                                    <label>å†…å­˜åœ°å€ (0-255)</label>
                                    <div class="input-slider-group">
                                        <input type="number" id="memAddress" min="0" max="255" placeholder="åœ°å€">
                                        <input type="number" id="memLength" min="1" max="10" value="1" placeholder="é•¿åº¦">
                                        <button class="button" onclick="readMemory()">è¯»å–</button>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label>å¿«é€Ÿè®¿é—®</label>
                                    <div class="preset-grid">
                                        <button class="preset-button" onclick="quickRead(63)">æ¸©åº¦</button>
                                        <button class="preset-button" onclick="quickRead(13)">æ¸©åº¦é™åˆ¶</button>
                                        <button class="preset-button" onclick="quickRead(62)">ç”µå‹</button>
                                        <button class="preset-button" onclick="quickRead(66)">é”™è¯¯çŠ¶æ€</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="collapsible" id="firmwarePanel">
                            <div class="collapsible-header" onclick="toggleCollapsible('firmwarePanel')">
                                <div class="collapsible-title">
                                    <span>ğŸ“Š</span>
                                    <span>å›ºä»¶ä¿¡æ¯</span>
                                </div>
                                <span class="collapsible-icon">â–¼</span>
                            </div>
                            <div class="collapsible-content">
                                <button class="button" onclick="getFirmwareInfo()">è·å–å›ºä»¶ä¿¡æ¯</button>
                            </div>
                        </div>

                        <div class="empty-state" style="margin-top: 20px;">
                            <div class="empty-icon">âš™ï¸</div>
                            <div class="empty-title">é«˜çº§åŠŸèƒ½</div>
                            <div class="empty-description">ç‚¹å‡»ä¸Šæ–¹æŠ˜å é¢æ¿è®¿é—®é«˜çº§é…ç½®é€‰é¡¹</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§é¢æ¿ - çŠ¶æ€ç›‘æ§ -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon">ğŸ“Š</div>
                        <span>çŠ¶æ€ç›‘æ§</span>
                    </div>
                    <button class="button" onclick="refreshSelectedStatus()" style="width: auto; padding: 8px 16px;">
                        <span>ğŸ”„</span> åˆ·æ–°
                    </button>
                </div>

                <div id="statusPanel">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“ˆ</div>
                        <div class="empty-title">é€‰æ‹©è®¾å¤‡æŸ¥çœ‹çŠ¶æ€</div>
                        <div class="empty-description">è®¾å¤‡çŠ¶æ€ä¿¡æ¯å°†åœ¨æ­¤å¤„æ˜¾ç¤º</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨æ—¥å¿—é¢æ¿ -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <div class="panel-icon">ğŸ“</div>
                    <span>ç³»ç»Ÿæ—¥å¿—</span>
                </div>
                <button class="button secondary" onclick="clearLog()" style="width: auto; padding: 8px 16px; font-size: 0.8rem;">
                    æ¸…ç©ºæ—¥å¿—
                </button>
            </div>
            <div class="log" id="logContent">
                <div class="log-entry info">[ç³»ç»Ÿ] Seeed RoboCore Studio åˆå§‹åŒ–å®Œæˆ</div>
                <div class="log-entry info">[ç³»ç»Ÿ] æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</div>
            </div>
        </div>
    </div>

    <script>
        class SeeedRoboCoreController {
            constructor() {
                this.ws = null;
                this.selectedServoId = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.monitoringInterval = null;
                this.monitoringActive = false;

                // å®æ—¶æ§åˆ¶ç›¸å…³å˜é‡
                this.controlMode = 'manual';
                this.realtimeEnabled = false;
                this.lastMoveTime = 0;
                this.moveDebounceDelay = 50;

                // æ ‡å®šå‘å¯¼ç›¸å…³å˜é‡
                this.calibrationStep = 1;
                this.calibrationData = {
                    servoId: null,
                    temperatureLimit: 75,
                    centerPosition: 2048
                };

                this.init();
            }

            init() {
                this.connect();
                this.addLog('[ç³»ç»Ÿ] Seeed RoboCore Studio åˆå§‹åŒ–å®Œæˆ', 'success');
                this.addLog('[ç³»ç»Ÿ] æ­£åœ¨è¿æ¥æœåŠ¡å™¨...', 'info');
            }

            connect() {
                this.ws = new WebSocket('ws://localhost:8765');

                this.ws.onopen = () => {
                    this.addLog('[WebSocket] æœåŠ¡å™¨è¿æ¥æˆåŠŸ', 'success');
                    this.updateConnectionStatus(true);
                    this.reconnectAttempts = 0;
                };

                this.ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    this.handleMessage(message);
                };

                this.ws.onclose = () => {
                    this.addLog('[WebSocket] è¿æ¥æ–­å¼€', 'warning');
                    this.updateConnectionStatus(false);
                    this.attemptReconnect();
                };

                this.ws.onerror = (error) => {
                    this.addLog(`[WebSocket] è¿æ¥é”™è¯¯: ${error}`, 'error');
                    this.updateConnectionStatus(false);
                };
            }

            attemptReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.reconnectAttempts++;
                    this.addLog(`[ç³»ç»Ÿ] å°è¯•é‡è¿ (${this.reconnectAttempts}/${this.maxReconnectAttempts})`, 'info');
                    setTimeout(() => this.connect(), 3000);
                } else {
                    this.addLog('[ç³»ç»Ÿ] è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°', 'error');
                }
            }

            handleMessage(message) {
                switch (message.type) {
                    case 'connection':
                        this.handleConnection(message);
                        break;
                    case 'scan_result':
                        this.handleScanResult(message);
                        break;
                    case 'servo_status':
                        this.handleServoStatus(message);
                        break;
                    case 'move_result':
                        this.handleMoveResult(message);
                        break;
                    case 'memory_read':
                        this.handleMemoryRead(message);
                        break;
                    case 'firmware_info':
                        this.handleFirmwareInfo(message);
                        break;
                    case 'pid_params':
                        this.handlePidParams(message);
                        break;
                    case 'temperature_limit_read':
                        this.handleTemperatureLimit(message);
                        break;
                    case 'servo_id_set_result':
                        this.handleServoIdSetResult(message);
                        break;
                    case 'error':
                        this.addLog(`[æœåŠ¡å™¨] é”™è¯¯: ${message.message}`, 'error');
                        break;
                    default:
                        this.addLog(`[ç³»ç»Ÿ] æœªçŸ¥æ¶ˆæ¯ç±»å‹: ${message.type}`, 'warning');
                }
            }

            handleConnection(message) {
                this.addLog(`[ç³»ç»Ÿ] æœåŠ¡å™¨çŠ¶æ€: ${message.status}`,
                           message.status === 'connected' ? 'success' : 'info');
            }

            handleScanResult(message) {
                this.addLog(`[æ‰«æ] å®Œæˆ: å‘ç° ${message.count} ä¸ªè®¾å¤‡`, 'success');
                this.displayServoList(message.servos);

                // éšè—æ‰«æçŠ¶æ€
                const scanStatus = document.getElementById('scanStatus');
                if (scanStatus) {
                    scanStatus.style.display = 'none';
                }

                // å¡«å……æ ‡å®šé€‰æ‹©å™¨
                this.populateCalibrationSelectors(message.servos);
            }

            populateCalibrationSelectors(servos) {
                // å¡«å……å„ç§æ ‡å®šé€‰æ‹©å™¨
                const selectors = [
                    'calibrationServoSelect',
                    'tempCalibrationServoSelect',
                    'centerCalibrationServoSelect'
                ];

                selectors.forEach(selectorId => {
                    const select = document.getElementById(selectorId);
                    if (select) {
                        const currentValue = select.value;
                        select.innerHTML = '<option value="">é€‰æ‹©èˆµæœº...</option>';

                        servos.forEach(servo => {
                            const option = document.createElement('option');
                            option.value = servo.id;
                            option.textContent = `èˆµæœº #${servo.id} - ${servo.model_number || 'FTServo'}`;
                            if (currentValue == servo.id) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });
                    }
                });
            }

            handleServoStatus(message) {
                this.updateServoStatus(message.status);
                if (this.monitoringActive) {
                    this.addLog(`[ç›‘æ§] è®¾å¤‡ ${message.servo_id} çŠ¶æ€å·²æ›´æ–°`, 'info');
                }
            }

            handleMoveResult(message) {
                if (message.success) {
                    this.addLog(`[æ§åˆ¶] è®¾å¤‡ ${message.servo_id} ç§»åŠ¨æˆåŠŸ`, 'success');
                } else {
                    this.addLog(`[æ§åˆ¶] è®¾å¤‡ ${message.servo_id} ç§»åŠ¨å¤±è´¥: ${message.error}`, 'error');
                }
            }

            handleMemoryRead(message) {
                if (message.success) {
                    this.addLog(`[å†…å­˜] åœ°å€ ${message.address}: ${message.data}`, 'success');
                } else {
                    this.addLog(`[å†…å­˜] è¯»å–å¤±è´¥: ${message.error}`, 'error');
                }
            }

            handleFirmwareInfo(message) {
                this.addLog(`[å›ºä»¶] è®¾å¤‡ ${message.servo_id} å›ºä»¶ä¿¡æ¯è·å–æˆåŠŸ`, 'success');
                this.updateFirmwareInfo(message.info);
            }

            handlePidParams(message) {
                this.addLog(`[PID] è®¾å¤‡ ${message.servo_id} å‚æ•°è·å–æˆåŠŸ`, 'success');
                this.updatePidParams(message.params);
            }

            handleTemperatureLimit(message) {
                if (message.success) {
                    this.addLog(`[æ¸©åº¦] æ¸©åº¦é™åˆ¶: ${message.limit}Â°C`, 'success');
                    const tempLimitDisplay = document.getElementById('tempLimitDisplay');
                    const tempLimitSlider = document.getElementById('tempLimitSlider');
                    const currentTempLimit = document.getElementById('currentTempLimit');

                    if (tempLimitDisplay) tempLimitDisplay.textContent = `${message.limit}Â°C`;
                    if (tempLimitSlider) tempLimitSlider.value = message.limit;
                    if (currentTempLimit) currentTempLimit.textContent = `${message.limit}Â°C`;
                } else {
                    this.addLog(`[æ¸©åº¦] è¯»å–æ¸©åº¦é™åˆ¶å¤±è´¥: ${message.error}`, 'error');
                }
            }

            handleServoIdSetResult(message) {
                if (message.success) {
                    this.addLog(`[IDé…ç½®] èˆµæœºIDè®¾ç½®æˆåŠŸ: ${message.old_id} -> ${message.new_id}`, 'success');
                    // è‡ªåŠ¨é‡æ–°æ‰«æä»¥æ›´æ–°è®¾å¤‡åˆ—è¡¨
                    setTimeout(() => {
                        this.sendMessage({
                            type: 'scan_servos',
                            start_id: 1,
                            end_id: 20
                        });
                    }, 1000);
                } else {
                    this.addLog(`[IDé…ç½®] èˆµæœºIDè®¾ç½®å¤±è´¥: ${message.error}`, 'error');
                }
            }

            updateConnectionStatus(connected) {
                const indicator = document.getElementById('statusIndicator');
                const status = document.getElementById('connectionStatus');

                if (connected) {
                    indicator.classList.add('connected');
                    status.textContent = 'å·²è¿æ¥åˆ°æœåŠ¡å™¨';
                } else {
                    indicator.classList.remove('connected');
                    status.textContent = 'è¿æ¥æ–­å¼€';
                }
            }

            displayServoList(servos) {
                const listContainer = document.getElementById('servoList');
                listContainer.innerHTML = '';

                if (servos.length === 0) {
                    listContainer.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ¤–</div>
                            <div class="empty-title">æœªå‘ç°è®¾å¤‡</div>
                            <div class="empty-description">è¯·æ£€æŸ¥è®¾å¤‡è¿æ¥å’Œä¾›ç”µ</div>
                        </div>
                    `;
                    return;
                }

                servos.forEach(servo => {
                    const servoElement = document.createElement('div');
                    servoElement.className = 'servo-item';
                    servoElement.onclick = () => this.selectServo(servo.id);

                    servoElement.innerHTML = `
                        <div class="servo-id">èˆµæœº #${servo.id}</div>
                        <div class="servo-info">
                            <span>å‹å·: ${servo.model_number || 'FTServo'}</span>
                            <div class="servo-status">
                                <div class="status-dot"></div>
                                <span>åœ¨çº¿</span>
                            </div>
                        </div>
                        <div class="servo-details">
                            <div class="servo-detail-item">
                                <span>ğŸ”—</span>
                                <span>ID: ${servo.id}</span>
                            </div>
                            <div class="servo-detail-item">
                                <span>ğŸ“‹</span>
                                <span>${servo.vendor || 'FEETECH'}</span>
                            </div>
                            <div class="servo-detail-item">
                                <span>â±ï¸</span>
                                <span>åˆšåˆšæ‰«æ</span>
                            </div>
                        </div>
                    `;

                    listContainer.appendChild(servoElement);
                });
            }

            selectServo(servoId) {
                this.selectedServoId = servoId;

                // æ›´æ–°UIé€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.servo-item').forEach(item => {
                    item.classList.remove('selected');
                });
                event.currentTarget.classList.add('selected');

                // æ˜¾ç¤ºæ§åˆ¶é¢æ¿
                this.showControlPanel();

                // è·å–èˆµæœºçŠ¶æ€
                this.getServoStatus(servoId);

                this.addLog(`[æ§åˆ¶] å·²é€‰æ‹©èˆµæœº ${servoId}`, 'success');
            }

            showControlPanel() {
                const controlPanel = document.getElementById('controlPanel');
                controlPanel.innerHTML = `
                    <div class="control-mode-toggle">
                        <button class="mode-button active" id="manualMode" onclick="setControlMode('manual')">
                            ğŸ¯ æ‰‹åŠ¨æ¨¡å¼
                        </button>
                        <button class="mode-button" id="realtimeMode" onclick="setControlMode('realtime')">
                            âš¡ å®æ—¶æ¨¡å¼
                        </button>
                    </div>

                    <div class="control-group">
                        <label>ä½ç½®æ§åˆ¶ (0-4095) <span id="realtimeIndicator" style="display: none;" class="realtime-indicator"><span class="realtime-dot"></span>å®æ—¶</span></label>
                        <div class="slider-container">
                            <input type="range" id="positionSlider" class="slider" min="0" max="4095" value="2048" oninput="updatePositionFromSlider(this.value)">
                            <span class="slider-value" id="positionValue">2048</span>
                        </div>
                        <div class="input-slider-group">
                            <input type="number" id="positionInput" min="0" max="4095" value="2048" onchange="updatePositionFromInput(this.value)">
                            <button class="button" onclick="moveServo()" id="moveButton">ğŸš€ ç§»åŠ¨åˆ°ä½ç½®</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>é€Ÿåº¦æ§åˆ¶ (0-2047)</label>
                        <div class="slider-container">
                            <input type="range" id="speedSlider" class="slider" min="0" max="2047" value="100" oninput="updateSpeedFromSlider(this.value)">
                            <span class="slider-value" id="speedValue">100</span>
                        </div>
                        <div class="input-slider-group">
                            <input type="number" id="speedInput" min="0" max="2047" value="100" onchange="updateSpeedFromInput(this.value)">
                        </div>
                    </div>

                    <div class="control-group">
                        <label>åŠ é€Ÿåº¦æ§åˆ¶ (0-255)</label>
                        <div class="slider-container">
                            <input type="range" id="accelSlider" class="slider" min="0" max="255" value="50" oninput="updateAccelFromSlider(this.value)">
                            <span class="slider-value" id="accelValue">50</span>
                        </div>
                        <div class="input-slider-group">
                            <input type="number" id="accelInput" min="0" max="255" value="50" onchange="updateAccelFromInput(this.value)">
                        </div>
                    </div>

                    <div class="control-group">
                        <label>å¿«é€Ÿä½ç½®é¢„è®¾</label>
                        <div class="preset-grid">
                            <button class="preset-button" onclick="setPosition(0)">0Â°</button>
                            <button class="preset-button" onclick="setPosition(1024)">90Â°</button>
                            <button class="preset-button" onclick="setPosition(2048)">180Â°</button>
                            <button class="preset-button" onclick="setPosition(3072)">270Â°</button>
                            <button class="preset-button" onclick="setPosition(512)">45Â°</button>
                            <button class="preset-button" onclick="setPosition(1536)">135Â°</button>
                            <button class="preset-button" onclick="setPosition(2560)">225Â°</button>
                            <button class="preset-button" onclick="setPosition(3584)">315Â°</button>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="button danger" onclick="stopServo()">â¹ï¸ åœæ­¢èˆµæœº</button>
                        <button class="button success" onclick="readTemperature()">ğŸŒ¡ï¸ è¯»å–æ¸©åº¦</button>
                    </div>
                `;

                // åˆå§‹åŒ–å®æ—¶æ§åˆ¶
                this.initRealtimeControl();
            }

            // å®æ—¶æ§åˆ¶æ–¹æ³•
            initRealtimeControl() {
                this.realtimeEnabled = false;
                this.updateControlModeUI();
            }

            setControlMode(mode) {
                this.controlMode = mode;
                this.realtimeEnabled = (mode === 'realtime');
                this.updateControlModeUI();

                if (this.realtimeEnabled) {
                    this.addLog('[æ§åˆ¶] å®æ—¶æ¨¡å¼å·²å¯ç”¨ - æ‹–åŠ¨æ»‘å—å³å¯æ§åˆ¶', 'success');
                    document.getElementById('realtimeIndicator').style.display = 'inline-flex';
                } else {
                    this.addLog('[æ§åˆ¶] æ‰‹åŠ¨æ¨¡å¼å·²å¯ç”¨ - ç‚¹å‡»æŒ‰é’®æ‰§è¡Œç§»åŠ¨', 'info');
                    document.getElementById('realtimeIndicator').style.display = 'none';
                }
            }

            updateControlModeUI() {
                const manualBtn = document.getElementById('manualMode');
                const realtimeBtn = document.getElementById('realtimeMode');
                const moveBtn = document.getElementById('moveButton');

                if (this.controlMode === 'realtime') {
                    manualBtn.classList.remove('active');
                    realtimeBtn.classList.add('active');
                    if (moveBtn) moveBtn.textContent = 'âš¡ å®æ—¶æ§åˆ¶ä¸­';
                } else {
                    manualBtn.classList.add('active');
                    realtimeBtn.classList.remove('active');
                    if (moveBtn) moveBtn.textContent = 'ğŸš€ ç§»åŠ¨åˆ°ä½ç½®';
                }
            }

            moveServoRealtime(position, speed, acceleration) {
                // é˜²æŠ–å¤„ç†
                const now = Date.now();
                if (now - this.lastMoveTime < this.moveDebounceDelay) {
                    return;
                }
                this.lastMoveTime = now;

                if (!this.selectedServoId) {
                    return;
                }

                this.sendMessage({
                    type: 'move_servo',
                    servo_id: this.selectedServoId,
                    position: parseInt(position),
                    speed: parseInt(speed),
                    acceleration: parseInt(acceleration)
                });
            }

            updateServoStatus(status) {
                if (!status || status.id !== this.selectedServoId) return;

                const statusPanel = document.getElementById('statusPanel');
                statusPanel.innerHTML = `
                    <div class="status-display">
                        <div class="status-item">
                            <span class="status-label">è¿æ¥çŠ¶æ€:</span>
                            <span class="status-value">${status.connected ? 'âœ… å·²è¿æ¥' : 'âŒ æ–­å¼€'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">è®¾å¤‡å‹å·:</span>
                            <span class="status-value">${status.model_number || 'FTServo'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰ä½ç½®:</span>
                            <span class="status-value">${status.position || 'N/A'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰é€Ÿåº¦:</span>
                            <span class="status-value">${status.speed || 'N/A'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰æ¸©åº¦:</span>
                            <span class="status-value">${status.temperature ? status.temperature + 'Â°C' : 'N/A'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰ç”µå‹:</span>
                            <span class="status-value">${status.voltage ? status.voltage.toFixed(1) + 'V' : 'N/A'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰ç”µæµ:</span>
                            <span class="status-value">${status.current ? status.current + 'mA' : 'N/A'}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æ›´æ–°æ—¶é—´:</span>
                            <span class="status-value">${new Date(status.timestamp * 1000).toLocaleTimeString()}</span>
                        </div>
                    </div>
                `;
            }

            updateFirmwareInfo(info) {
                if (info && info.servo_id === this.selectedServoId) {
                    this.addLog(`[å›ºä»¶] ç‰ˆæœ¬ V${info.firmware_major}.${info.firmware_minor}, ç¡¬ä»¶ V${info.hardware_major}.${info.hardware_minor}`, 'info');
                }
            }

            updatePidParams(params) {
                if (params && params.servo_id === this.selectedServoId) {
                    // æ›´æ–°PIDé¢æ¿çš„è¾“å…¥å€¼
                    const elements = {
                        'posP': params.position_pid.P,
                        'posI': params.position_pid.I,
                        'posD': params.position_pid.D,
                        'speedP': params.speed_pid.P,
                        'speedI': params.speed_pid.I,
                        'startupTorque': params.startup_torque
                    };

                    for (const [id, value] of Object.entries(elements)) {
                        const element = document.getElementById(id);
                        if (element && value !== null) {
                            element.value = value;
                        }
                    }
                }
            }

            startMonitoring() {
                if (this.monitoringActive || !this.selectedServoId) {
                    this.addLog('[ç›‘æ§] è¯·å…ˆé€‰æ‹©èˆµæœº', 'warning');
                    return;
                }

                this.monitoringActive = true;
                document.getElementById('monitoringStatus').style.display = 'inline-flex';

                this.monitoringInterval = setInterval(() => {
                    if (this.selectedServoId) {
                        this.getServoStatus(this.selectedServoId);
                    }
                }, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡

                this.addLog('[ç›‘æ§] å®æ—¶ç›‘æ§å·²å¯åŠ¨', 'success');
            }

            stopMonitoring() {
                this.monitoringActive = false;
                document.getElementById('monitoringStatus').style.display = 'none';

                if (this.monitoringInterval) {
                    clearInterval(this.monitoringInterval);
                    this.monitoringInterval = null;
                }

                this.addLog('[ç›‘æ§] å®æ—¶ç›‘æ§å·²åœæ­¢', 'info');
            }

            sendMessage(message) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(message));
                    return true;
                }
                this.addLog('[WebSocket] æ— æ³•å‘é€æ¶ˆæ¯: è¿æ¥æ–­å¼€', 'error');
                return false;
            }

            addLog(message, type = 'info') {
                const logContent = document.getElementById('logContent');
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.textContent = `[${timestamp}] ${message}`;

                logContent.appendChild(logEntry);
                logContent.scrollTop = logContent.scrollHeight;

                // é™åˆ¶æ—¥å¿—æ¡æ•°
                const entries = logContent.children;
                if (entries.length > 100) {
                    logContent.removeChild(entries[0]);
                }
            }

            // æ ‡å®šå‘å¯¼æ–¹æ³•
            startCalibrationWizard() {
                this.calibrationStep = 1;
                this.showCalibrationStep(1);
                switchTab('calibration');
                this.addLog('[æ ‡å®š] å¼€å§‹è®¾å¤‡æ ‡å®šå‘å¯¼', 'info');
            }

            showCalibrationStep(step) {
                // éšè—æ‰€æœ‰æ­¥éª¤
                document.querySelectorAll('.wizard-step').forEach(el => {
                    el.classList.remove('active');
                });

                // æ˜¾ç¤ºå½“å‰æ­¥éª¤
                document.getElementById(`step${step}-content`).classList.add('active');

                // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
                document.querySelectorAll('.progress-step').forEach((el, index) => {
                    el.classList.remove('active', 'completed');
                    if (index < step - 1) {
                        el.classList.add('completed');
                    } else if (index === step - 1) {
                        el.classList.add('active');
                    }
                });

                // æ›´æ–°å¯¼èˆªæŒ‰é’®
                const prevButton = document.getElementById('prevButton');
                const nextButton = document.getElementById('nextButton');

                if (step === 1) {
                    prevButton.style.visibility = 'hidden';
                } else {
                    prevButton.style.visibility = 'visible';
                }

                if (step === 5) {
                    nextButton.style.display = 'none';
                } else {
                    nextButton.style.display = 'flex';
                }

                this.calibrationStep = step;
            }

            nextCalibrationStep() {
                if (this.calibrationStep < 5) {
                    this.showCalibrationStep(this.calibrationStep + 1);
                }
            }

            previousCalibrationStep() {
                if (this.calibrationStep > 1) {
                    this.showCalibrationStep(this.calibrationStep - 1);
                }
            }
        }

        // å…¨å±€æ§åˆ¶å™¨å®ä¾‹
        let controller;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            controller = new SeeedRoboCoreController();
        });

        // Tabåˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // æ›´æ–°tabæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°tabå†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // æŠ˜å é¢æ¿åŠŸèƒ½
        function toggleCollapsible(panelId) {
            const panel = document.getElementById(panelId);
            panel.classList.toggle('open');
        }

        // å®æ—¶æ§åˆ¶å‡½æ•°
        function setControlMode(mode) {
            controller.setControlMode(mode);
        }

        function updatePositionFromSlider(value) {
            document.getElementById('positionValue').textContent = value;
            document.getElementById('positionInput').value = value;

            if (controller.realtimeEnabled && controller.selectedServoId) {
                const speed = document.getElementById('speedSlider').value;
                const acceleration = document.getElementById('accelSlider').value;
                controller.moveServoRealtime(value, speed, acceleration);
            }
        }

        function updatePositionFromInput(value) {
            document.getElementById('positionSlider').value = value;
            document.getElementById('positionValue').textContent = value;
        }

        function updateSpeedFromSlider(value) {
            document.getElementById('speedValue').textContent = value;
            document.getElementById('speedInput').value = value;
        }

        function updateSpeedFromInput(value) {
            document.getElementById('speedSlider').value = value;
            document.getElementById('speedValue').textContent = value;
        }

        function updateAccelFromSlider(value) {
            document.getElementById('accelValue').textContent = value;
            document.getElementById('accelInput').value = value;
        }

        function updateAccelFromInput(value) {
            document.getElementById('accelSlider').value = value;
            document.getElementById('accelValue').textContent = value;
        }

        function setPosition(value) {
            document.getElementById('positionSlider').value = value;
            document.getElementById('positionInput').value = value;
            document.getElementById('positionValue').textContent = value;

            if (controller.realtimeEnabled && controller.selectedServoId) {
                const speed = document.getElementById('speedSlider').value;
                const acceleration = document.getElementById('accelSlider').value;
                controller.moveServoRealtime(value, speed, acceleration);
            }
        }

        // æ ‡å®šç›¸å…³å‡½æ•°
        function startCalibrationWizard() {
            controller.startCalibrationWizard();
        }

        function nextCalibrationStep() {
            controller.nextCalibrationStep();
        }

        function previousCalibrationStep() {
            controller.previousCalibrationStep();
        }

        function updateTempLimitDisplay(value) {
            document.getElementById('tempLimitDisplay').textContent = `${value}Â°C`;
        }

        function updateCenterPositionDisplay(value) {
            document.getElementById('centerPositionDisplay').textContent = value;
        }

        function setCalibrationServoId() {
            const servoId = parseInt(document.getElementById('calibrationServoId').value);
            controller.calibrationData.servoId = servoId;
            controller.selectedServoId = servoId;
            controller.addLog(`[æ ‡å®š] è®¾ç½®èˆµæœºIDä¸º ${servoId}`, 'success');
            controller.nextCalibrationStep();
        }

        function setTemperatureLimit() {
            const tempLimit = parseInt(document.getElementById('tempLimitSlider').value);
            controller.calibrationData.temperatureLimit = tempLimit;

            controller.sendMessage({
                type: 'write_temperature_limit',
                servo_id: controller.selectedServoId,
                temp_limit: tempLimit
            });

            controller.addLog(`[æ ‡å®š] è®¾ç½®æ¸©åº¦é™åˆ¶ä¸º ${tempLimit}Â°C`, 'success');
            setTimeout(() => controller.nextCalibrationStep(), 1000);
        }

        function moveToCenterPosition() {
            const position = parseInt(document.getElementById('centerPositionSlider').value);

            controller.sendMessage({
                type: 'move_servo',
                servo_id: controller.selectedServoId,
                position: position,
                speed: 100,
                acceleration: 50
            });

            controller.addLog(`[æ ‡å®š] ç§»åŠ¨åˆ°ä¸­ä½ä½ç½® ${position}`, 'info');
        }

        function saveCenterPosition() {
            const position = parseInt(document.getElementById('centerPositionSlider').value);
            controller.calibrationData.centerPosition = position;
            controller.addLog(`[æ ‡å®š] ä¿å­˜ä¸­ä½ä½ç½® ${position}`, 'success');
            controller.nextCalibrationStep();

            // æ›´æ–°å®Œæˆæ­¥éª¤çš„æ‘˜è¦
            document.getElementById('summaryServoId').textContent = controller.calibrationData.servoId;
            document.getElementById('summaryTempLimit').textContent = `${controller.calibrationData.temperatureLimit}Â°C`;
            document.getElementById('summaryCenterPosition').textContent = position;
        }

        function restartCalibration() {
            controller.calibrationData = {
                servoId: null,
                temperatureLimit: 75,
                centerPosition: 2048
            };
            controller.showCalibrationStep(1);
        }

        function finishCalibration() {
            controller.addLog('[æ ‡å®š] æ ‡å®šå®Œæˆï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨å®æ—¶æ§åˆ¶åŠŸèƒ½äº†', 'success');
            switchTab('control');

            // å¦‚æœæœ‰é€‰ä¸­çš„èˆµæœºï¼Œæ˜¾ç¤ºæ§åˆ¶é¢æ¿
            if (controller.selectedServoId) {
                controller.showControlPanel();
            }
        }

        // å…¨å±€åŠŸèƒ½å‡½æ•°
        function scanServos() {
            // æ˜¾ç¤ºæ‰«æçŠ¶æ€
            const scanStatus = document.getElementById('scanStatus');
            if (scanStatus) {
                scanStatus.style.display = 'flex';
            }

            controller.sendMessage({
                type: 'scan_servos',
                start_id: 1,
                end_id: 20
            });

            controller.addLog('[æ‰«æ] å¼€å§‹é‡æ–°æ‰«æè®¾å¤‡...', 'info');
        }

        // æ–°çš„çµæ´»æ ‡å®šåŠŸèƒ½
        function selectCalibrationType(type) {
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.calibration-step-card').forEach(card => {
                card.classList.remove('active', 'completed');
            });

            // æ¿€æ´»é€‰ä¸­çš„ç±»å‹
            const selectedCard = document.getElementById(`calibration-${type}`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }

            // æ˜¾ç¤ºå¯¹åº”çš„æ ‡å®šå†…å®¹
            showCalibrationContent(type);
        }

        function showCalibrationContent(type) {
            const contentArea = document.getElementById('calibrationContent');
            let contentHTML = '';

            switch(type) {
                case 'id':
                    contentHTML = `
                        <div class="wizard-content">
                            <div class="wizard-title">
                                <span>ğŸ·ï¸</span>
                                <span>IDé…ç½®</span>
                            </div>
                            <div class="wizard-description">
                                ä¸ºèˆµæœºè®¾ç½®å”¯ä¸€çš„IDæ ‡è¯†ï¼Œä¾¿äºç³»ç»Ÿç®¡ç†å’Œè¯†åˆ«
                            </div>

                            <div class="control-group">
                                <label>é€‰æ‹©è¦é…ç½®çš„èˆµæœº</label>
                                <select id="calibrationServoSelect" onchange="updateCalibrationInputs()">
                                    <option value="">è¯·å…ˆæ‰«æè®¾å¤‡</option>
                                </select>
                            </div>

                            <div class="control-group">
                                <label>æ–°èˆµæœºID (1-253)</label>
                                <input type="number" id="newServoId" min="1" max="253" value="1">
                            </div>

                            <div class="button-group">
                                <button class="button" onclick="scanServosForCalibration()">
                                    <span>ğŸ”</span> é‡æ–°æ‰«æ
                                </button>
                                <button class="button success" onclick="setServoId()">
                                    <span>ğŸ’¾</span> è®¾ç½®ID
                                </button>
                            </div>
                        </div>
                    `;
                    break;

                case 'temperature':
                    contentHTML = `
                        <div class="wizard-content">
                            <div class="wizard-title">
                                <span>ğŸŒ¡ï¸</span>
                                <span>æ¸©åº¦é™åˆ¶è®¾ç½®</span>
                            </div>
                            <div class="wizard-description">
                                è®¾ç½®èˆµæœºçš„æ¸©åº¦ä¿æŠ¤é˜ˆå€¼ï¼Œé˜²æ­¢è¿‡çƒ­æŸåè®¾å¤‡
                            </div>

                            <div class="control-group">
                                <label>é€‰æ‹©è¦é…ç½®çš„èˆµæœº</label>
                                <select id="tempCalibrationServoSelect" onchange="updateCurrentTempLimit()">
                                    <option value="">è¯·å…ˆæ‰«æè®¾å¤‡</option>
                                </select>
                            </div>

                            <div class="control-group">
                                <label>å½“å‰æ¸©åº¦é™åˆ¶: <span id="currentTempLimit">æœªçŸ¥</span></label>
                                <div class="slider-container">
                                    <input type="range" id="tempLimitSlider" class="slider" min="50" max="100" value="75" oninput="updateTempLimitDisplay(this.value)">
                                    <span class="slider-value" id="tempLimitDisplay">75Â°C</span>
                                </div>
                            </div>

                            <div class="button-group">
                                <button class="button" onclick="scanServosForCalibration()">
                                    <span>ğŸ”</span> é‡æ–°æ‰«æ
                                </button>
                                <button class="button" onclick="readCurrentTempLimit()">
                                    <span>ğŸ“–</span> è¯»å–å½“å‰å€¼
                                </button>
                                <button class="button success" onclick="setTemperatureLimit()">
                                    <span>ğŸ’¾</span> ä¿å­˜æ¸©åº¦é™åˆ¶
                                </button>
                            </div>
                        </div>
                    `;
                    break;

                case 'center':
                    contentHTML = `
                        <div class="wizard-content">
                            <div class="wizard-title">
                                <span>ğŸ¯</span>
                                <span>ä¸­ä½æ ¡å‡†</span>
                            </div>
                            <div class="wizard-description">
                                æ‰‹åŠ¨æ ¡å‡†èˆµæœºçš„ä¸­ä½ä½ç½®ï¼Œç¡®ä¿èˆµç›˜æœä¸Šæ—¶çš„ç²¾åº¦
                            </div>

                            <div class="manual-calibration-mode">
                                <div class="manual-mode-header">
                                    <span>âš ï¸</span>
                                    <span>æ‰‹åŠ¨æ ¡å‡†æ¨¡å¼</span>
                                </div>
                                <p>åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œèˆµæœºæ‰­çŸ©å°†è¢«ç¦ç”¨ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨è½¬åŠ¨èˆµæœºåˆ°æ­£ç¡®ä½ç½®ã€‚</p>
                                <button class="disable-torque-button" id="torqueDisableBtn" onclick="toggleTorqueDisable()">
                                    <span id="torqueBtnText">ğŸ”“ ç¦ç”¨èˆµæœºæ‰­çŸ©</span>
                                </button>
                            </div>

                            <div class="control-group">
                                <label>é€‰æ‹©è¦æ ¡å‡†çš„èˆµæœº</label>
                                <select id="centerCalibrationServoSelect" onchange="updateCenterCalibration()">
                                    <option value="">è¯·å…ˆæ‰«æè®¾å¤‡</option>
                                </select>
                            </div>

                            <div class="control-group">
                                <label>å½“å‰ä¸­ä½ä½ç½®: <span id="currentCenterPosition">æœªçŸ¥</span>
                                    <span class="position-indicator" id="positionIndicator" style="display: none;">æ‰‹åŠ¨æ¨¡å¼</span>
                                </label>
                                <div class="slider-container">
                                    <input type="range" id="centerPositionSlider" class="slider" min="0" max="4095" value="2048" oninput="updateCenterPositionDisplay(this.value)" disabled>
                                    <span class="slider-value" id="centerPositionDisplay">2048</span>
                                </div>
                            </div>

                            <div class="control-group">
                                <label>æ ¡å‡†æŒ‡å¼•:</label>
                                <div style="background: #FEF3C7; border: 1px solid #FCD34D; border-radius: 6px; padding: 10px; font-size: 0.85rem; color: #92400E;">
                                    1. ç‚¹å‡»"ç¦ç”¨èˆµæœºæ‰­çŸ©"æŒ‰é’®<br>
                                    2. æ‰‹åŠ¨è½¬åŠ¨èˆµæœºä½¿èˆµç›˜å®Œå…¨æœä¸Š<br>
                                    3. ç‚¹å‡»"ä¿å­˜ä¸­ä½ä½ç½®"æŒ‰é’®
                                </div>
                            </div>

                            <div class="button-group">
                                <button class="button" onclick="scanServosForCalibration()">
                                    <span>ğŸ”</span> é‡æ–°æ‰«æ
                                </button>
                                <button class="button" onclick="readCurrentCenterPosition()">
                                    <span>ğŸ“–</span> è¯»å–å½“å‰å€¼
                                </button>
                                <button class="button success" onclick="saveCenterPositionManual()">
                                    <span>ğŸ’¾</span> ä¿å­˜ä¸­ä½ä½ç½®
                                </button>
                                <button class="button" onclick="testCenterPosition()">
                                    <span>ğŸ¯</span> æµ‹è¯•ä¸­ä½
                                </button>
                            </div>
                        </div>
                    `;
                    break;
            }

            contentArea.innerHTML = contentHTML;

            // è‡ªåŠ¨æ‰«æè®¾å¤‡å¡«å……é€‰æ‹©å™¨
            scanServosForCalibration();
        }

        // æ›´æ–°æ ‡å®šè¾“å…¥æ¡†çš„è®¾å¤‡é€‰æ‹©å™¨
        function updateCalibrationInputs() {
            // è¿™é‡Œå¯ä»¥å¡«å……è®¾å¤‡åˆ—è¡¨åˆ°é€‰æ‹©å™¨
            // æš‚æ—¶å…ˆä¿æŒç®€å•
        }

        // ç¦ç”¨/å¯ç”¨æ‰­çŸ©åŠŸèƒ½
        function toggleTorqueDisable() {
            const btn = document.getElementById('torqueDisableBtn');
            const btnText = document.getElementById('torqueBtnText');
            const slider = document.getElementById('centerPositionSlider');
            const indicator = document.getElementById('positionIndicator');

            if (!controller.selectedServoId) {
                const select = document.getElementById('centerCalibrationServoSelect');
                const servoId = parseInt(select.value);
                if (servoId) {
                    controller.selectedServoId = servoId;
                } else {
                    alert('è¯·å…ˆé€‰æ‹©è¦æ ¡å‡†çš„èˆµæœº');
                    return;
                }
            }

            const isDisabled = btn.classList.contains('active');

            if (isDisabled) {
                // å¯ç”¨æ‰­çŸ©
                controller.sendMessage({
                    type: 'move_servo',
                    servo_id: controller.selectedServoId,
                    position: parseInt(slider.value),
                    speed: 50,
                    acceleration: 20
                });

                btn.classList.remove('active');
                btnText.textContent = 'ğŸ”“ ç¦ç”¨èˆµæœºæ‰­çŸ©';
                slider.disabled = false;
                indicator.style.display = 'none';

                controller.addLog('[ä¸­ä½æ ¡å‡†] å·²å¯ç”¨èˆµæœºæ‰­çŸ©', 'info');
            } else {
                // ç¦ç”¨æ‰­çŸ©
                controller.sendMessage({
                    type: 'stop_servo',
                    servo_id: controller.selectedServoId
                });

                btn.classList.add('active');
                btnText.textContent = 'ğŸ”’ å¯ç”¨èˆµæœºæ‰­çŸ©';
                slider.disabled = true;
                indicator.style.display = 'inline-block';

                controller.addLog('[ä¸­ä½æ ¡å‡†] å·²ç¦ç”¨èˆµæœºæ‰­çŸ©ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒæ•´ä½ç½®', 'warning');
            }
        }

        // ä¿å­˜ä¸­ä½ä½ç½®ï¼ˆæ‰‹åŠ¨æ ¡å‡†ç‰ˆï¼‰
        function saveCenterPositionManual() {
            const position = parseInt(document.getElementById('centerPositionDisplay').textContent);

            // è¿™é‡Œåº”è¯¥ä¿å­˜åˆ°èˆµæœºçš„EEPROMä¸­
            // æš‚æ—¶å…ˆä½¿ç”¨å†…å­˜å†™å…¥
            controller.calibrationData.centerPosition = position;

            controller.addLog(`[ä¸­ä½æ ¡å‡†] ä¿å­˜ä¸­ä½ä½ç½®: ${position}`, 'success');

            // æ ‡å®šå®Œæˆï¼Œé‡æ–°å¯ç”¨æ‰­çŸ©
            const btn = document.getElementById('torqueDisableBtn');
            if (btn.classList.contains('active')) {
                toggleTorqueDisable();
            }
        }

        // æµ‹è¯•ä¸­ä½ä½ç½®
        function testCenterPosition() {
            const position = controller.calibrationData.centerPosition || 2048;

            controller.sendMessage({
                type: 'move_servo',
                servo_id: controller.selectedServoId,
                position: position,
                speed: 100,
                acceleration: 50
            });

            controller.addLog(`[ä¸­ä½æ ¡å‡†] æµ‹è¯•ç§»åŠ¨åˆ°ä¸­ä½: ${position}`, 'info');
        }

        function scanServosForCalibration() {
            scanServos();
        }

        // IDè®¾ç½®å‡½æ•°
        function setServoId() {
            const select = document.getElementById('calibrationServoSelect');
            const newId = document.getElementById('newServoId').value;

            if (!select.value || !newId) {
                alert('è¯·é€‰æ‹©èˆµæœºå¹¶è¾“å…¥æ–°ID');
                return;
            }

            const oldId = parseInt(select.value);
            const newIdNum = parseInt(newId);

            controller.sendMessage({
                type: 'set_servo_id',
                old_id: oldId,
                new_id: newIdNum
            });

            controller.addLog(`[IDé…ç½®] è®¾ç½®èˆµæœºID: ${oldId} -> ${newIdNum}`, 'info');
        }

        // è¯»å–å½“å‰æ¸©åº¦é™åˆ¶
        function readCurrentTempLimit() {
            const select = document.getElementById('tempCalibrationServoSelect');
            if (!select.value) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            controller.selectedServoId = parseInt(select.value);
            controller.getTemperatureLimit(controller.selectedServoId);
        }

        // è¯»å–å½“å‰ä¸­ä½ä½ç½®
        function readCurrentCenterPosition() {
            const select = document.getElementById('centerCalibrationServoSelect');
            if (!select.value) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            controller.selectedServoId = parseInt(select.value);
            controller.getServoStatus(controller.selectedServoId);

            // æ›´æ–°æ˜¾ç¤º
            controller.sendMessage({
                type: 'read_memory',
                servo_id: controller.selectedServoId,
                address: 2048, // å‡è®¾ä¸­ä½å­˜å‚¨åœ¨æŸä¸ªåœ°å€
                length: 2
            });
        }

        // æ›´æ–°ä¸­ä½æ ¡å‡†
        function updateCenterCalibration() {
            const select = document.getElementById('centerCalibrationServoSelect');
            if (select.value) {
                controller.selectedServoId = parseInt(select.value);
                controller.addLog(`[ä¸­ä½æ ¡å‡†] é€‰æ‹©èˆµæœº: ${controller.selectedServoId}`, 'info');
            }
        }

        // æ›´æ–°æ¸©åº¦é™åˆ¶æ˜¾ç¤º
        function updateTempLimitDisplay(value) {
            document.getElementById('tempLimitDisplay').textContent = `${value}Â°C`;
        }

        // æ›´æ–°ä¸­ä½ä½ç½®æ˜¾ç¤º
        function updateCenterPositionDisplay(value) {
            document.getElementById('centerPositionDisplay').textContent = value;
            if (document.getElementById('currentCenterPosition')) {
                document.getElementById('currentCenterPosition').textContent = value;
            }
        }

        function moveServo() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            const position = parseInt(document.getElementById('positionInput').value);
            const speed = parseInt(document.getElementById('speedInput').value);
            const acceleration = parseInt(document.getElementById('accelInput').value);

            controller.sendMessage({
                type: 'move_servo',
                servo_id: controller.selectedServoId,
                position: position,
                speed: speed,
                acceleration: acceleration
            });
        }

        function stopServo() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            controller.sendMessage({
                type: 'stop_servo',
                servo_id: controller.selectedServoId
            });
        }

        function readTemperature() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }
            controller.sendMessage({
                type: 'read_memory',
                servo_id: controller.selectedServoId,
                address: 63,
                length: 1
            });
        }

        function refreshSelectedStatus() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }
            controller.sendMessage({
                type: 'get_servo_status',
                servo_id: controller.selectedServoId
            });
        }

        function getServoStatus() {
            if (!controller.selectedServoId) {
                return;
            }
            controller.sendMessage({
                type: 'get_servo_status',
                servo_id: controller.selectedServoId
            });
        }

        function getFirmwareInfo() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }
            controller.sendMessage({
                type: 'get_firmware_info',
                servo_id: controller.selectedServoId
            });
        }

        function readPidParams() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }
            controller.sendMessage({
                type: 'read_pid_params',
                servo_id: controller.selectedServoId
            });
        }

        function writePidParams() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            const position_pid = [
                parseInt(document.getElementById('posP').value),
                parseInt(document.getElementById('posI').value),
                parseInt(document.getElementById('posD').value)
            ];

            const speed_pid = [
                parseInt(document.getElementById('speedP').value),
                parseInt(document.getElementById('speedI').value)
            ];

            controller.sendMessage({
                type: 'write_pid_params',
                servo_id: controller.selectedServoId,
                position_pid: position_pid,
                speed_pid: speed_pid
            });
        }

        function readMemory() {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            const address = parseInt(document.getElementById('memAddress').value);
            const length = parseInt(document.getElementById('memLength').value);

            if (isNaN(address) || isNaN(length)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åœ°å€å’Œé•¿åº¦');
                return;
            }

            controller.sendMessage({
                type: 'read_memory',
                servo_id: controller.selectedServoId,
                address: address,
                length: length
            });
        }

        function quickRead(address) {
            if (!controller.selectedServoId) {
                alert('è¯·å…ˆé€‰æ‹©èˆµæœº');
                return;
            }

            controller.sendMessage({
                type: 'read_memory',
                servo_id: controller.selectedServoId,
                address: address,
                length: 1
            });
        }

        function clearLog() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = '<div class="log-entry info">[ç³»ç»Ÿ] æ—¥å¿—å·²æ¸…ç©º</div>';
        }

        // ä¸ºcontrollerå®ä¾‹æ·»åŠ é¢å¤–æ–¹æ³•
        SeeedRoboCoreController.prototype.getServoStatus = function(servoId) {
            this.sendMessage({
                type: 'get_servo_status',
                servo_id: servoId
            });
        };

        SeeedRoboCoreController.prototype.getFirmwareInfo = function(servoId) {
            this.sendMessage({
                type: 'get_firmware_info',
                servo_id: servoId
            });
        };

        SeeedRoboCoreController.prototype.getPidParams = function(servoId) {
            this.sendMessage({
                type: 'read_pid_params',
                servo_id: servoId
            });
        };

        SeeedRoboCoreController.prototype.getTemperatureLimit = function(servoId) {
            this.sendMessage({
                type: 'read_temperature_limit',
                servo_id: servoId
            });
        };
    </script>
</body>
</html>